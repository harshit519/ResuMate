{% extends 'resume/base.html' %}
{% block title %}{{ resume.title }} • ResuMate{% endblock %}
{% block content %}
<div class="row gy-4">
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        {% if resume.photo %}
          <img src="{{ resume.photo.url }}" class="rounded-circle mb-3" width="120" height="120" alt="photo">
        {% else %}
          <div class="rounded-circle bg-secondary mb-3" style="width:120px;height:120px;margin:0 auto;"></div>
        {% endif %}
        <h4 class="mb-0">{{ resume.full_name }}</h4>
        <div class="text-muted">{{ resume.location }}</div>
        <div class="mt-3 small">
          <div>{{ resume.email }}</div>
          <div>{{ resume.phone }}</div>
        </div>
        <div class="d-flex gap-2 justify-content-center mt-3">
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'resume_edit' resume.pk %}">Edit</a>
          <form method="post" action="{% url 'resume_delete' resume.pk %}">
            {% csrf_token %}
            <button class="btn btn-outline-danger btn-sm">Delete</button>
          </form>
          <a class="btn btn-primary btn-sm" id="downloadBtn" href="{% url 'resume_print' resume.pk %}">Download</a>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        {% if resume.summary %}
        <h5>Summary</h5>
        <p>{{ resume.summary|linebreaks }}</p>
        <hr>
        {% endif %}

        {% if resume.experiences.all %}
        <h5>Experience</h5>
        <div class="timeline">
          {% for e in resume.experiences.all %}
            <div class="mb-3">
              <div class="d-flex justify-content-between">
                <strong>{{ e.job_title }}</strong>
                <span class="text-muted small">{{ e.start_date }} - {% if e.is_current %}Present{% else %}{{ e.end_date|default:'-' }}{% endif %}</span>
              </div>
              <div class="text-muted">{{ e.company }}{% if e.location %} • {{ e.location }}{% endif %}</div>
              {% if e.description %}<div class="small mt-1">{{ e.description|linebreaks }}</div>{% endif %}
            </div>
          {% endfor %}
        </div>
        <hr>
        {% endif %}

        {% if resume.educations.all %}
        <h5>Education</h5>
        {% for ed in resume.educations.all %}
          <div class="mb-2">
            <strong>{{ ed.degree }}</strong> — {{ ed.institution }}
            <div class="text-muted small">{{ ed.start_year }} - {{ ed.end_year|default:'-' }}</div>
            {% if ed.description %}<div class="small">{{ ed.description|linebreaks }}</div>{% endif %}
          </div>
        {% endfor %}
        <hr>
        {% endif %}

        {% if resume.skills.all %}
        <h5>Skills</h5>
        <div class="d-flex flex-wrap gap-2">
          {% for s in resume.skills.all %}
            {% if s.level == 'Advanced' %}
              <span class="badge text-bg-success">{{ s.name }} — {{ s.level }}</span>
            {% elif s.level == 'Intermediate' %}
              <span class="badge text-bg-info">{{ s.name }} — {{ s.level }}</span>
            {% else %}
              <span class="badge text-bg-secondary">{{ s.name }} — {{ s.level }}</span>
            {% endif %}
          {% endfor %}
        </div>
        <hr>
        {% endif %}

        {% if resume.projects.all %}
        <h5>Projects</h5>
        {% for p in resume.projects.all %}
          <div class="mb-2">
            <strong>{{ p.name }}</strong>{% if p.role %} — {{ p.role }}{% endif %}
            {% if p.link %}<a href="{{ p.link }}" target="_blank" rel="noopener" class="ms-2">Link</a>{% endif %}
            {% if p.description %}<div class="small">{{ p.description|linebreaks }}</div>{% endif %}
          </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Auth Modal for download action -->
{% if not request.user.is_authenticated %}
<div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Sign in to download</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">Please login or create an account to download your resume.</p>
        <div class="d-flex gap-2">
          <a href="{% url 'login' %}" class="btn btn-primary w-50">Login</a>
          <a href="{% url 'register' %}" class="btn btn-outline-primary w-50">Register</a>
        </div>
      </div>
    </div>
  </div>
 </div>

 <script>
  $(function(){
    $('#downloadBtn').on('click', function(e){
      {% if not request.user.is_authenticated %}
        e.preventDefault();
        var modal = new bootstrap.Modal(document.getElementById('authModal'));
        modal.show();
      {% endif %}
    });
  });
 </script>
{% endif %}
{% endblock %}


